---
title: 'AtomVM: Elixir ç”¨ main.avm ã®æ›¸ãè¾¼ã¿ä½ç½®'
tags:
  - Erlang
  - Elixir
  - ESP32
  - AtomVM
private: false
updated_at: '2025-12-16T11:34:21+09:00'
id: caa55d2402e2c7d1304b
organization_url_name: fukuokaex
slide: false
ignorePublish: false
---
## ã¯ã˜ã‚ã«

AtomVM ä¸Šã§ Elixir ã‚¢ãƒ—ãƒªï¼ˆ`main.avm`ï¼‰ã‚’å‹•ã‹ã™ã¨ãã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã¨æ›¸ãè¾¼ã¿ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆ`flash_offset`ï¼‰ã‚’æŠŠæ¡ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã‚Œã‚‰ãŒã‚ˆãåˆ†ã‹ã‚‰ãšä½•å›ã‹ãƒãƒã‚Šã¾ã—ãŸã€‚

`main.avm` ã®æ›¸ãè¾¼ã¿ã«æˆåŠŸã—ãŸã‚ã¨ã«ã€AtomVM ãŒåˆ¥ã®å ´æ‰€ã‚’èª­ã¿ã«è¡Œãã€çµæœã¨ã—ã¦ä½•æ•…ã‹ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãªã„ã¨ã„ã†çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

åŒã˜ã“ã¨ã§æ™‚é–“ã‚’æº¶ã‹ã•ãªã„ãŸã‚ã«ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

![piyopiyo-board-2025-12.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/82804/31d01365-5ac5-45dd-a125-bee49ea93d57.png)

â€» å†™çœŸã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™

## å¯¾è±¡ç’°å¢ƒ

- ãƒã‚¤ã‚³ãƒ³
  - ESP32-S3
- ãƒ›ã‚¹ãƒˆ PC
  - Debian ç³» Linux
- ä¸»ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢
  - AtomVM 0.7.0-devï¼ˆé–‹ç™ºç‰ˆï¼‰
  - ESP-IDF v5.5

## çµè«–

è¦‹ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆã¯ 2 ã¤ã§ã™ã€‚

- `idf.py partition-table`ã§ `main.avm` ã® ã‚ªãƒ•ã‚»ãƒƒãƒˆ ã‚’ç¢ºèª
- Elixir å´ï¼ˆ`mix.exs`ï¼‰ã® `flash_offset` ã‚’ã€ãã® ã‚ªãƒ•ã‚»ãƒƒãƒˆ ã¨ä¸€è‡´ã•ã›ã‚‹

https://doc.atomvm.org/main/getting-started-guide.html#esp32-deployment-overview

## ESP32 å´

Elixir å¯¾å¿œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹å ´åˆã¯ã€
å…¬å¼ã«å¾“ã£ã¦ `sdkconfig.defaults` ãƒ•ã‚¡ã‚¤ãƒ«ã§ `partitions-elixir.csv` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

https://github.com/atomvm/AtomVM/blob/main/src/platforms/esp32/sdkconfig.defaults

```diff_bash:sdkconfig.defaults
+ CONFIG_PARTITION_TABLE_CUSTOM_FILENAME="partitions-elixir.csv"
```

## Elixirå´

Elixir å´ã§ã¯ `mix.exs` ã« `flash_offset` ã‚’æŒ‡å®šã™ã‚‹å ´æ‰€ãŒã‚ã‚Šã¾ã™ã€‚

https://github.com/atomvm/atomvm_examples/blob/312ee0d5e96cccddc7c5032db1feb9e6959834d7/elixir/HelloWorld/mix.exs#L33

## ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèªã™ã‚‹

AtomVM ã® ESP32 ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ç¢ºèªã—ã¾ã™ã€‚

```bash
cd ~/Projects/atomvm/AtomVM/src/platforms/esp32
source ~/esp/esp-idf/export.sh

idf.py partition-table
```

æ‰‹å…ƒã®æ§‹æˆï¼ˆElixir ç”¨ï¼‰ã§ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã¾ã—ãŸã€‚

```text
*******************************************************************************
# ESP-IDF Partition Table
# Name, Type, SubType, Offset, Size, Flags
nvs,data,nvs,0x9000,24K,
phy_init,data,phy,0xf000,4K,
factory,app,factory,0x10000,1792K,
boot.avm,data,phy,0x1d0000,512K,
main.avm,data,phy,0x250000,1M,
*******************************************************************************
```

å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã«ãŠæ‰‹æœ¬ï¼ˆï¼Ÿï¼‰ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚

https://github.com/atomvm/AtomVM/blob/main/src/platforms/esp32/partitions-elixir.csv

## ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒã‚ºãƒ¬ãŸã¨ãã®ç›´ã—æ–¹

ã©ã“ã‹ã§æ‰‹é †ã‚’é–“é•ã£ãŸã®ã‹
`idf.py partition-table` ã®è¡¨ç¤ºã§ `main.avm` ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒæƒ³å®šã¨é•ã†å ´åˆãŒã‚ã‚Šã¾ã—ãŸã€‚

è‡ªåˆ†ã¯æ¬¡ã®æµã‚Œã§ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```bash
cd ~/Projects/atomvm/AtomVM/src/platforms/esp32

idf.py fullclean # ã‚‚ã—ãã¯ rm -rf build
idf.py reconfigure
idf.py partition-table
```

:tada::tada::tada:

## ãŠã‚ã‚Šã«

AtomVMï¼ˆElixirï¼‰ã§ã‚¢ãƒ—ãƒªã‚’æ›¸ãè¾¼ã‚€ã¨ãã¯ã€ä»¥ä¸‹ã® 2 ã¤ã‚’åˆã‚ã›ã‚‹ã¨ã„ã†ã“ã¨ã‚’è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚

* `idf.py partition-table` ã® `main.avm` ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
* Elixir å´ã® ã‚ªãƒ•ã‚»ãƒƒãƒˆ(`flash_offset`)

 ğŸŒ ğŸŒ ğŸŒ

https://piyopiyoex.connpass.com/event/377298/
